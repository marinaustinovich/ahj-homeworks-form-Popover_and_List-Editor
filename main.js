(()=>{"use strict";const t={popover:{valueMissing:"It's necessary to write text"},email:{valueMissing:"It's necessary to write email",typeMismatch:"It's not email!"},name:{valueMissing:"It's necessary to write text"},cost:{valueMissing:"It's necessary to write cost",rangeUnderflow:"Enter a number greater than 0"}};function e(t,e){t.forEach((t=>{const s=t.dataset?t.dataset.id:null,{value:o}=t;s&&(e[s]=o)}))}class s{constructor(t,e){this.row=e,this.dataProduct=t,this.bindToDOM()}bindToDOM(){this.row.innerHTML=`\n    <th class="product-name">${this.dataProduct.name}</th>\n    <th class="product-cost">${+this.dataProduct.cost}</th>\n    <th><span class="update">✎</span><span class="delete">✖</span></th>\n    `}events(t){const e=t.querySelector(".update"),s=t.querySelector(".delete");e.addEventListener("click",(()=>this.update(this.dataProduct))),s.addEventListener("click",(()=>this.delete()))}update(t){const e=document.querySelector("#editor-form");e.setAttribute("data-id",t.id),e.closest(".editor-form-container").classList.add("editor-form-container_visible");const s=e.querySelector('[data-id="name"]'),o=e.querySelector('[data-id="cost"]');s.value=t.name,o.value=t.cost}delete(){this._deleteMessage=document.querySelector(".delete-message"),this._deleteMessage.classList.add("delete-message_visible"),this._deleteMessage.setAttribute("data-id",this.dataProduct.id);const t=document.querySelector("tbody").getBoundingClientRect();this._deleteMessage.style.left=t.left+window.scrollX+t.width/2-this._deleteMessage.offsetWidth/2+"px",this._deleteMessage.style.top=`${t.top+window.scrollY}px`}markUp(){return this.row.innerHTML}}const o=[];class i{constructor(){this._tooltips=[]}showTooltip(t,e){const s=document.createElement("DIV");s.classList.add("form-error"),s.textContent=t;const o=performance.now();this._tooltips.push({id:o,element:s}),document.body.appendChild(s);const{left:i,bottom:n}=e.getBoundingClientRect();return s.style.left=`${window.scrollX+i}px`,s.style.top=`${n+5}px`,o}removeTooltip(t){this._tooltips.find((e=>e.id===t)).element.remove(),this._tooltips=this._tooltips.filter((e=>e.id!==t))}}const n=(t,e)=>{const s=Object.keys(ValidityState.prototype).find((e=>!!t.name&&("valid"!==e&&t.validity[e])));return!!s&&e[t.name][s]};class r{constructor(t){this._container=t,this._formContainer=null,this._errorElement=null,this._form=null,this._tooltipFactory=new i,this.productsArray=[],this.actualMessages=[]}bindToDOM(t){this.createFormContainer(t||{name:"",cost:""}),this.setEvents()}createFormContainer(t){this._formContainer=document.createElement("div"),this._formContainer.classList.add("editor-form-container"),this.setFormData(t),this._formContainer.innerHTML=r.formMarkup(this.formData),this._container.append(this._formContainer),this._form=this._container.querySelector("#editor-form"),this._errorElement=this._container.querySelector(".editor-form-error")}setFormData(t){this.formData=t}setEvents(){this._form.querySelector('[data-toggle="editor-close"]').addEventListener("click",(()=>this.closeForm())),this._form.addEventListener("submit",(t=>this.onSubmit(t))),this._form.addEventListener("focus",(()=>{}),!0),this._form.addEventListener("blur",(t=>this.elementOnBlur(t)),!0)}elementOnBlur(e){const s=e.target,o=n(s,t),i=this.actualMessages.findIndex((t=>t.name===s.name));o?-1===i&&this.showTooltip(o,s):-1!==i&&(this._tooltipFactory.removeTooltip(this.actualMessages[i].id),this.actualMessages.splice(i,1))}closeForm(){this._form.dataset.id&&this._form.removeAttribute("data-id"),this._form.reset(),this._formContainer.classList.remove("editor-form-container_visible")}onSubmit(t){t.preventDefault(),this.handleValidation()}handleValidation(){this.formElements=[...this._form.elements],this.actualMessages.forEach((t=>this._tooltipFactory.removeTooltip(t.id))),this.actualMessages=[],this._form.checkValidity()?this.processFormData():this.showErrors()}showErrors(){this.formElements.forEach((e=>{const s=n(e,t);s&&this.showTooltip(s,e)}))}processFormData(){this._form.dataset.id?this.updateProduct():this.createProduct(),this.closeForm()}updateProduct(){const t=+this._form.dataset.id,s=o.findIndex((e=>e.id===t)),i=o[s];e(this.formElements,i);const n=this._container.querySelector(`[data-row="${t}"]`);n.querySelector(".product-name").innerText=i.name,n.querySelector(".product-cost").innerText=i.cost}createProduct(){const t={};e(this.formElements,t),t.id=Date.now();const i=this._container.querySelector("tbody"),n=document.createElement("tr"),r=new s(t,n);o.push(r.dataProduct),n.classList.add("product-row"),n.innerHTML=r.markUp(),n.setAttribute("data-row",t.id),r.events(n),i.append(n)}showTooltip(t,e){this.actualMessages.push({name:e.name,id:this._tooltipFactory.showTooltip(t,e)})}static formMarkup(t){return`\n            <form id="editor-form" novalidate>\n                <div class="form-control form-editor">\n                  <label class="label-editor" for="name">Название</label>\n                  <input name="name" data-id="name" class="input input-editor" type="text" placeholder="product name" autocomplete="off" value="${t.name}" required> \n                </div>\n                <div class="form-control form-editor">\n                  <label for="cost" class="label-editor">Стоимость</label>\n                  <input name="cost" data-id="cost" class="input input-editor" type="number" min="1" placeholder="product cost" autocomplete="off" value="${t.cost}" required>\n                </div>\n\n                <div class="editor-btn">\n                  <button type="submit" class="btn btn-add" data-toggle="editor-add" title="Submit editor form">Сохранить</button>\n                  <button type="button" class="btn btn-close" data-toggle="editor-close" title="Close editor form">Закрыть</button>\n                </div>\n              </form>\n          `}}class a{constructor(){this._container=null}bindToDOM(t){this._container=t,this.drawUi(),this.setEventListeners()}drawUi(){this.isBound()&&(this._container.innerHTML=a.markUp)}isBound(){return null!==this._container}setEventListeners(){if(!this.isBound())return;this._container.querySelector(".btn").addEventListener("click",(t=>this.onClick(t)))}static get markUp(){return'\n      <div class="wrapper-btn">\n        <a tabindex="0" role="button" class="btn" data-toggle="popover" title="Popover title" data-content="And here\'s some amazing content?">Click to toggle popover</a>\n      </div>\n      <div class="popover-message">\n        <h3 class="popover-title">Popover title</h3>\n        <p class="popover-text">And here\'s some amazing content. It\'s very engaging. Right?"</p>\n      </div>\n    '}onClick(t){this.popoverMessage=this._container.querySelector(".popover-message"),this.popoverMessage.classList.toggle("popover-message_visible"),this.positionPopoverMessage(t)}positionPopoverMessage(t){const e=t.currentTarget.getBoundingClientRect(),s=this.popoverMessage.getBoundingClientRect(),o=e.left+e.width/2-s.width/2+window.scrollX,i=e.top-s.height-20+window.scrollY;this.popoverMessage.style.left=`${o}px`,this.popoverMessage.style.top=`${i}px`}}console.log("it works!");(new a).bindToDOM(document.querySelector("#popover-container"));(new class{constructor(){this._container=null,this.editorForm=null,this.deleteMessage=null,this.products=o}bindToDOM(t){this._container=t,this.drawUi(),this.events()}drawUi(){this.checkBinding(),this._container.innerHTML='\n      <table class="table">\n        <caption class="title-table">My editor</caption>\n        <thead>\n          <tr class="products">\n            <th  colspan="2" style="text-align:left">Товары</th>\n            <th style="text-align:right" data-id="add"><span class="add">✙</span></th>\n          </tr>\n          <tr class="product-table">\n            <th>Название</th>\n            <th>Стоимость</th>\n            <th>Действия</th>\n          </tr>\n        </thead>\n        <tbody></tbody>\n      </table>\n      <div class="delete-message">\n        <h2>Вы действительно хотите удалить товар?</h2>\n        <div class="editor-btn">\n          <button type="button" class="btn btn-add" data-toggle="delete-product" title="Button for delete product">Да</button>\n          <button type="button" class="btn btn-close" data-toggle="close-message" title="Close delete message">Нет</button>\n        </div>\n      </div>\n      ';new r(this._container).bindToDOM(),this.editorForm=this._container.querySelector(".editor-form-container"),this.deleteMessage=this._container.querySelector(".delete-message")}checkBinding(){if(null===this._container)throw new Error("Form not bind to DOM")}events(){const t=this._container.querySelector('[data-id="add"]'),e=this._container.querySelector('[data-toggle="delete-product"]'),s=this._container.querySelector('[data-toggle="close-message"]');t.addEventListener("click",(()=>this.showForm())),e.addEventListener("click",(t=>this.deleteProduct(t))),s.addEventListener("click",(()=>this.closeMessage()))}showForm(){this.editorForm.classList.add("editor-form-container_visible");const t=this._container.querySelector("tbody").getBoundingClientRect();this.editorForm.style.left=t.left+window.scrollX+t.width/2-this.editorForm.offsetWidth/2+"px",this.editorForm.style.top=`${t.top+window.scrollY}px`}deleteProduct(){const t=o.findIndex((t=>t.id===+this.deleteMessage.dataset.id));o.splice(t,1);const e=this._container.querySelector(`[data-row="${this.deleteMessage.dataset.id}"]`);e.parentNode.removeChild(e),this.closeMessage()}closeMessage(){this.deleteMessage.classList.remove("delete-message_visible")}}).bindToDOM(document.querySelector("#editor-container"))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZUFDRTdILEtBQUt1SCxjQUFjdkcsVUFBVWlDLE9BQU8seUJBQ3RDLElEdEZLOUMsVUFBVVUsU0FBU04sY0FBYyxxQiIsInNvdXJjZXMiOlsid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9FZGl0b3JGb3JtL21lc3NhZ2VzLmpzIiwid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9jcmVhdGVEYXRhLmpzIiwid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9Qcm9kdWN0LmpzIiwid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9wcm9kdWN0c0FycmF5LmpzIiwid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9Ub29sdGlwL1Rvb2x0aXAuanMiLCJ3ZWJwYWNrOi8vcG9wb3Zlcl9hbmRfbGlzdC1lZGl0b3IvLi9zcmMvanMvRWRpdG9yL1Rvb2x0aXAvZ2V0RXJyb3IuanMiLCJ3ZWJwYWNrOi8vcG9wb3Zlcl9hbmRfbGlzdC1lZGl0b3IvLi9zcmMvanMvRWRpdG9yL0VkaXRvckZvcm0vRWRpdG9yRm9ybS5qcyIsIndlYnBhY2s6Ly9wb3BvdmVyX2FuZF9saXN0LWVkaXRvci8uL3NyYy9qcy9Qb3BvdmVyL1BvcG92ZXIuanMiLCJ3ZWJwYWNrOi8vcG9wb3Zlcl9hbmRfbGlzdC1lZGl0b3IvLi9zcmMvanMvYXBwLmpzIiwid2VicGFjazovL3BvcG92ZXJfYW5kX2xpc3QtZWRpdG9yLy4vc3JjL2pzL0VkaXRvci9FZGl0b3IuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbWVzc2FnZXMgPSB7XG4gIHBvcG92ZXI6IHtcbiAgICB2YWx1ZU1pc3Npbmc6IFwiSXQncyBuZWNlc3NhcnkgdG8gd3JpdGUgdGV4dFwiLFxuICB9LFxuICBlbWFpbDoge1xuICAgIHZhbHVlTWlzc2luZzogXCJJdCdzIG5lY2Vzc2FyeSB0byB3cml0ZSBlbWFpbFwiLFxuICAgIHR5cGVNaXNtYXRjaDogXCJJdCdzIG5vdCBlbWFpbCFcIixcbiAgfSxcbiAgbmFtZToge1xuICAgIHZhbHVlTWlzc2luZzogXCJJdCdzIG5lY2Vzc2FyeSB0byB3cml0ZSB0ZXh0XCIsXG4gIH0sXG4gIGNvc3Q6IHtcbiAgICB2YWx1ZU1pc3Npbmc6IFwiSXQncyBuZWNlc3NhcnkgdG8gd3JpdGUgY29zdFwiLFxuICAgIHJhbmdlVW5kZXJmbG93OiAnRW50ZXIgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDAnLFxuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgbWVzc2FnZXM7XG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVEYXRhKGFycmF5LCBvKSB7XG4gIGFycmF5LmZvckVhY2goKGVsKSA9PiB7XG4gICAgY29uc3Qga2V5ID0gZWwuZGF0YXNldCA/IGVsLmRhdGFzZXQuaWQgOiBudWxsO1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IGVsO1xuXG4gICAgaWYgKCFrZXkpIHJldHVybjtcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSAqL1xuICAgIG9ba2V5XSA9IHZhbHVlO1xuICB9KTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFByb2R1Y3Qge1xuICBjb25zdHJ1Y3RvcihkYXRhLCBjb250YWluZXIpIHtcbiAgICB0aGlzLnJvdyA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmRhdGFQcm9kdWN0ID0gZGF0YTtcbiAgICB0aGlzLmJpbmRUb0RPTSgpO1xuICB9XG5cbiAgYmluZFRvRE9NKCkge1xuICAgIHRoaXMucm93LmlubmVySFRNTCA9IGBcbiAgICA8dGggY2xhc3M9XCJwcm9kdWN0LW5hbWVcIj4ke3RoaXMuZGF0YVByb2R1Y3QubmFtZX08L3RoPlxuICAgIDx0aCBjbGFzcz1cInByb2R1Y3QtY29zdFwiPiR7K3RoaXMuZGF0YVByb2R1Y3QuY29zdH08L3RoPlxuICAgIDx0aD48c3BhbiBjbGFzcz1cInVwZGF0ZVwiPuKcjjwvc3Bhbj48c3BhbiBjbGFzcz1cImRlbGV0ZVwiPuKcljwvc3Bhbj48L3RoPlxuICAgIGA7XG4gIH1cblxuICBldmVudHMoY29udGFpbmVyKSB7XG4gICAgY29uc3QgdXBkYXRlQnRuID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy51cGRhdGUnKTtcbiAgICBjb25zdCBkZWxldGVCdG4gPSBjb250YWluZXIucXVlcnlTZWxlY3RvcignLmRlbGV0ZScpO1xuXG4gICAgdXBkYXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy51cGRhdGUodGhpcy5kYXRhUHJvZHVjdCkpO1xuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuZGVsZXRlKCkpO1xuICB9XG5cbiAgLyogZXNsaW50LWRpc2FibGUgKi9cbiAgdXBkYXRlKGRhdGEpIHtcbiAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0b3ItZm9ybVwiKTtcbiAgICBmb3JtLnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgZGF0YS5pZCk7XG5cbiAgICBmb3JtXG4gICAgICAuY2xvc2VzdChcIi5lZGl0b3ItZm9ybS1jb250YWluZXJcIilcbiAgICAgIC5jbGFzc0xpc3QuYWRkKFwiZWRpdG9yLWZvcm0tY29udGFpbmVyX3Zpc2libGVcIik7XG4gICAgY29uc3QgbmFtZUlucHV0ID0gZm9ybS5xdWVyeVNlbGVjdG9yKCdbZGF0YS1pZD1cIm5hbWVcIl0nKTtcbiAgICBjb25zdCBjb3N0SW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPVwiY29zdFwiXScpO1xuICAgIG5hbWVJbnB1dC52YWx1ZSA9IGRhdGEubmFtZTtcbiAgICBjb3N0SW5wdXQudmFsdWUgPSBkYXRhLmNvc3Q7XG4gIH1cblxuICBkZWxldGUoKSB7XG4gICAgdGhpcy5fZGVsZXRlTWVzc2FnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGVsZXRlLW1lc3NhZ2VcIik7XG4gICAgdGhpcy5fZGVsZXRlTWVzc2FnZS5jbGFzc0xpc3QuYWRkKFwiZGVsZXRlLW1lc3NhZ2VfdmlzaWJsZVwiKTtcbiAgICB0aGlzLl9kZWxldGVNZXNzYWdlLnNldEF0dHJpYnV0ZShcImRhdGEtaWRcIiwgdGhpcy5kYXRhUHJvZHVjdC5pZCk7XG4gICAgXG4gICAgY29uc3QgdGJvZHlSZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigndGJvZHknKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB0aGlzLl9kZWxldGVNZXNzYWdlLnN0eWxlLmxlZnQgPSBgJHt0Ym9keVJlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYICsgdGJvZHlSZWN0LndpZHRoIC8gMiAtIHRoaXMuX2RlbGV0ZU1lc3NhZ2Uub2Zmc2V0V2lkdGggLyAyfXB4YDtcbiAgICB0aGlzLl9kZWxldGVNZXNzYWdlLnN0eWxlLnRvcCA9IGAke3Rib2R5UmVjdC50b3AgKyB3aW5kb3cuc2Nyb2xsWX1weGA7XG4gIH1cblxuICBtYXJrVXAoKSB7XG4gICAgcmV0dXJuIHRoaXMucm93LmlubmVySFRNTDtcbiAgfVxufVxuIiwiY29uc3QgcHJvZHVjdHNBcnJheSA9IFtdO1xuZXhwb3J0IGRlZmF1bHQgcHJvZHVjdHNBcnJheTtcbiIsImltcG9ydCAnLi90b29sdGlwLmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvb2x0aXAge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl90b29sdGlwcyA9IFtdO1xuICB9XG5cbiAgc2hvd1Rvb2x0aXAobWVzc2FnZSwgZWxlbWVudCkge1xuICAgIGNvbnN0IHRvb2x0aXBFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnRElWJyk7XG5cbiAgICB0b29sdGlwRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmb3JtLWVycm9yJyk7XG4gICAgdG9vbHRpcEVsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuXG4gICAgY29uc3QgaWQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgIHRoaXMuX3Rvb2x0aXBzLnB1c2goe1xuICAgICAgaWQsXG4gICAgICBlbGVtZW50OiB0b29sdGlwRWxlbWVudCxcbiAgICB9KTtcblxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcEVsZW1lbnQpO1xuXG4gICAgY29uc3QgeyBsZWZ0LCBib3R0b20gfSA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICB0b29sdGlwRWxlbWVudC5zdHlsZS5sZWZ0ID0gYCR7d2luZG93LnNjcm9sbFggKyBsZWZ0fXB4YDtcbiAgICB0b29sdGlwRWxlbWVudC5zdHlsZS50b3AgPSBgJHtib3R0b20gKyA1fXB4YDtcblxuICAgIHJldHVybiBpZDtcbiAgfVxuXG4gIHJlbW92ZVRvb2x0aXAoaWQpIHtcbiAgICBjb25zdCB0b29sdGlwID0gdGhpcy5fdG9vbHRpcHMuZmluZCgodCkgPT4gdC5pZCA9PT0gaWQpO1xuXG4gICAgdG9vbHRpcC5lbGVtZW50LnJlbW92ZSgpO1xuXG4gICAgdGhpcy5fdG9vbHRpcHMgPSB0aGlzLl90b29sdGlwcy5maWx0ZXIoKHQpID0+IHQuaWQgIT09IGlkKTtcbiAgfVxufVxuIiwiY29uc3QgZ2V0RXJyb3IgPSAoZWwsIGVycm9ycykgPT4ge1xuICBjb25zdCBlcnJvcktleSA9IE9iamVjdC5rZXlzKFZhbGlkaXR5U3RhdGUucHJvdG90eXBlKS5maW5kKChrZXkpID0+IHtcbiAgICBpZiAoIWVsLm5hbWUpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoa2V5ID09PSAndmFsaWQnKSByZXR1cm4gZmFsc2U7XG5cbiAgICByZXR1cm4gZWwudmFsaWRpdHlba2V5XTtcbiAgfSk7XG5cbiAgaWYgKCFlcnJvcktleSkgcmV0dXJuIGZhbHNlO1xuXG4gIHJldHVybiBlcnJvcnNbZWwubmFtZV1bZXJyb3JLZXldO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgZ2V0RXJyb3I7XG4iLCJpbXBvcnQgbWVzc2FnZXMgZnJvbSAnLi9tZXNzYWdlcyc7XG5pbXBvcnQgY3JlYXRlRGF0YSBmcm9tICcuLi9jcmVhdGVEYXRhJztcbmltcG9ydCBQcm9kdWN0IGZyb20gJy4uL1Byb2R1Y3QnO1xuaW1wb3J0IHByb2R1Y3RzQXJyYXkgZnJvbSAnLi4vcHJvZHVjdHNBcnJheSc7XG5cbmltcG9ydCAnLi9lZGl0b3ItZm9ybS5jc3MnO1xuaW1wb3J0IFRvb2x0aXAgZnJvbSAnLi4vVG9vbHRpcC9Ub29sdGlwJztcbmltcG9ydCBnZXRFcnJvciBmcm9tICcuLi9Ub29sdGlwL2dldEVycm9yJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRWRpdG9yRm9ybSB7XG4gIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikge1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLl9mb3JtQ29udGFpbmVyID0gbnVsbDtcbiAgICB0aGlzLl9lcnJvckVsZW1lbnQgPSBudWxsO1xuICAgIHRoaXMuX2Zvcm0gPSBudWxsO1xuICAgIHRoaXMuX3Rvb2x0aXBGYWN0b3J5ID0gbmV3IFRvb2x0aXAoKTtcblxuICAgIHRoaXMucHJvZHVjdHNBcnJheSA9IFtdO1xuICAgIHRoaXMuYWN0dWFsTWVzc2FnZXMgPSBbXTtcbiAgfVxuXG4gIGJpbmRUb0RPTShkYXRhKSB7XG4gICAgdGhpcy5jcmVhdGVGb3JtQ29udGFpbmVyKGRhdGEgfHwgeyBuYW1lOiAnJywgY29zdDogJycgfSk7XG4gICAgdGhpcy5zZXRFdmVudHMoKTtcbiAgfVxuXG4gIGNyZWF0ZUZvcm1Db250YWluZXIoZGF0YSkge1xuICAgIHRoaXMuX2Zvcm1Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aGlzLl9mb3JtQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2VkaXRvci1mb3JtLWNvbnRhaW5lcicpO1xuICAgIHRoaXMuc2V0Rm9ybURhdGEoZGF0YSk7XG4gICAgdGhpcy5fZm9ybUNvbnRhaW5lci5pbm5lckhUTUwgPSBFZGl0b3JGb3JtLmZvcm1NYXJrdXAodGhpcy5mb3JtRGF0YSk7XG4gICAgdGhpcy5fY29udGFpbmVyLmFwcGVuZCh0aGlzLl9mb3JtQ29udGFpbmVyKTtcbiAgICB0aGlzLl9mb3JtID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJyNlZGl0b3ItZm9ybScpO1xuICAgIHRoaXMuX2Vycm9yRWxlbWVudCA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZWRpdG9yLWZvcm0tZXJyb3InKTtcbiAgfVxuXG4gIHNldEZvcm1EYXRhKGRhdGEpIHtcbiAgICB0aGlzLmZvcm1EYXRhID0gZGF0YTtcbiAgfVxuXG4gIHNldEV2ZW50cygpIHtcbiAgICBjb25zdCBjbG9zZUJ0biA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcignW2RhdGEtdG9nZ2xlPVwiZWRpdG9yLWNsb3NlXCJdJyk7XG5cbiAgICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHRoaXMuY2xvc2VGb3JtKCkpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgKGUpID0+IHRoaXMub25TdWJtaXQoZSkpO1xuICAgIHRoaXMuX2Zvcm0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB7fSwgdHJ1ZSk7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKGUpID0+IHRoaXMuZWxlbWVudE9uQmx1cihlKSwgdHJ1ZSk7XG4gIH1cblxuICBlbGVtZW50T25CbHVyKGUpIHtcbiAgICBjb25zdCBlbCA9IGUudGFyZ2V0O1xuICAgIGNvbnN0IGVycm9yID0gZ2V0RXJyb3IoZWwsIG1lc3NhZ2VzKTtcblxuICAgIGNvbnN0IG1lc3NhZ2VJbmRleCA9IHRoaXMuYWN0dWFsTWVzc2FnZXMuZmluZEluZGV4KFxuICAgICAgKGl0ZW0pID0+IGl0ZW0ubmFtZSA9PT0gZWwubmFtZSxcbiAgICApO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBpZiAobWVzc2FnZUluZGV4ID09PSAtMSkge1xuICAgICAgICB0aGlzLnNob3dUb29sdGlwKGVycm9yLCBlbCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChtZXNzYWdlSW5kZXggIT09IC0xKSB7XG4gICAgICB0aGlzLl90b29sdGlwRmFjdG9yeS5yZW1vdmVUb29sdGlwKFxuICAgICAgICB0aGlzLmFjdHVhbE1lc3NhZ2VzW21lc3NhZ2VJbmRleF0uaWQsXG4gICAgICApO1xuICAgICAgdGhpcy5hY3R1YWxNZXNzYWdlcy5zcGxpY2UobWVzc2FnZUluZGV4LCAxKTtcbiAgICB9XG4gIH1cblxuICBjbG9zZUZvcm0oKSB7XG4gICAgaWYgKHRoaXMuX2Zvcm0uZGF0YXNldC5pZCkgdGhpcy5fZm9ybS5yZW1vdmVBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcblxuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgICB0aGlzLl9mb3JtQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2VkaXRvci1mb3JtLWNvbnRhaW5lcl92aXNpYmxlJyk7XG4gIH1cblxuICBvblN1Ym1pdChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuaGFuZGxlVmFsaWRhdGlvbigpO1xuICB9XG5cbiAgaGFuZGxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLmZvcm1FbGVtZW50cyA9IFsuLi50aGlzLl9mb3JtLmVsZW1lbnRzXTtcblxuICAgIHRoaXMuYWN0dWFsTWVzc2FnZXMuZm9yRWFjaCgobWVzc2FnZSkgPT4gdGhpcy5fdG9vbHRpcEZhY3RvcnkucmVtb3ZlVG9vbHRpcChtZXNzYWdlLmlkKSk7XG5cbiAgICB0aGlzLmFjdHVhbE1lc3NhZ2VzID0gW107XG5cbiAgICBpZiAoIXRoaXMuX2Zvcm0uY2hlY2tWYWxpZGl0eSgpKSB7XG4gICAgICB0aGlzLnNob3dFcnJvcnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5wcm9jZXNzRm9ybURhdGEoKTtcbiAgICB9XG4gIH1cblxuICBzaG93RXJyb3JzKCkge1xuICAgIHRoaXMuZm9ybUVsZW1lbnRzLmZvckVhY2goKGVsZW0pID0+IHtcbiAgICAgIGNvbnN0IGVycm9yID0gZ2V0RXJyb3IoZWxlbSwgbWVzc2FnZXMpO1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoZXJyb3IsIGVsZW0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJvY2Vzc0Zvcm1EYXRhKCkge1xuICAgIGlmICh0aGlzLl9mb3JtLmRhdGFzZXQuaWQpIHtcbiAgICAgIHRoaXMudXBkYXRlUHJvZHVjdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNyZWF0ZVByb2R1Y3QoKTtcbiAgICB9XG4gICAgdGhpcy5jbG9zZUZvcm0oKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2R1Y3QoKSB7XG4gICAgY29uc3QgaWQgPSArdGhpcy5fZm9ybS5kYXRhc2V0LmlkO1xuICAgIGNvbnN0IGluZGV4ID0gcHJvZHVjdHNBcnJheS5maW5kSW5kZXgoKGVsKSA9PiBlbC5pZCA9PT0gaWQpO1xuICAgIGNvbnN0IHByb2R1Y3REYXRhID0gcHJvZHVjdHNBcnJheVtpbmRleF07XG5cbiAgICBjcmVhdGVEYXRhKHRoaXMuZm9ybUVsZW1lbnRzLCBwcm9kdWN0RGF0YSk7XG5cbiAgICBjb25zdCBwcm9kdWN0ID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXJvdz1cIiR7aWR9XCJdYCk7XG4gICAgcHJvZHVjdC5xdWVyeVNlbGVjdG9yKCcucHJvZHVjdC1uYW1lJykuaW5uZXJUZXh0ID0gcHJvZHVjdERhdGEubmFtZTtcbiAgICBwcm9kdWN0LnF1ZXJ5U2VsZWN0b3IoJy5wcm9kdWN0LWNvc3QnKS5pbm5lclRleHQgPSBwcm9kdWN0RGF0YS5jb3N0O1xuICB9XG5cbiAgY3JlYXRlUHJvZHVjdCgpIHtcbiAgICBjb25zdCBmb3JtRGF0YSA9IHt9O1xuICAgIGNyZWF0ZURhdGEodGhpcy5mb3JtRWxlbWVudHMsIGZvcm1EYXRhKTtcblxuICAgIGZvcm1EYXRhLmlkID0gRGF0ZS5ub3coKTtcblxuICAgIGNvbnN0IHRhYmxlQm9keSA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCd0Ym9keScpO1xuICAgIGNvbnN0IHRhYmxlUm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICBjb25zdCBwcm9kdWN0ID0gbmV3IFByb2R1Y3QoZm9ybURhdGEsIHRhYmxlUm93KTtcblxuICAgIHByb2R1Y3RzQXJyYXkucHVzaChwcm9kdWN0LmRhdGFQcm9kdWN0KTtcblxuICAgIHRhYmxlUm93LmNsYXNzTGlzdC5hZGQoJ3Byb2R1Y3Qtcm93Jyk7XG4gICAgdGFibGVSb3cuaW5uZXJIVE1MID0gcHJvZHVjdC5tYXJrVXAoKTtcbiAgICB0YWJsZVJvdy5zZXRBdHRyaWJ1dGUoJ2RhdGEtcm93JywgZm9ybURhdGEuaWQpO1xuICAgIHByb2R1Y3QuZXZlbnRzKHRhYmxlUm93KTtcbiAgICB0YWJsZUJvZHkuYXBwZW5kKHRhYmxlUm93KTtcbiAgfVxuXG4gIHNob3dUb29sdGlwKG1lc3NhZ2UsIGVsKSB7XG4gICAgdGhpcy5hY3R1YWxNZXNzYWdlcy5wdXNoKHtcbiAgICAgIG5hbWU6IGVsLm5hbWUsXG4gICAgICBpZDogdGhpcy5fdG9vbHRpcEZhY3Rvcnkuc2hvd1Rvb2x0aXAobWVzc2FnZSwgZWwpLFxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGZvcm1NYXJrdXAoZm9ybURhdGEpIHtcbiAgICByZXR1cm4gYFxuICAgICAgICAgICAgPGZvcm0gaWQ9XCJlZGl0b3ItZm9ybVwiIG5vdmFsaWRhdGU+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tY29udHJvbCBmb3JtLWVkaXRvclwiPlxuICAgICAgICAgICAgICAgICAgPGxhYmVsIGNsYXNzPVwibGFiZWwtZWRpdG9yXCIgZm9yPVwibmFtZVwiPtCd0LDQt9Cy0LDQvdC40LU8L2xhYmVsPlxuICAgICAgICAgICAgICAgICAgPGlucHV0IG5hbWU9XCJuYW1lXCIgZGF0YS1pZD1cIm5hbWVcIiBjbGFzcz1cImlucHV0IGlucHV0LWVkaXRvclwiIHR5cGU9XCJ0ZXh0XCIgcGxhY2Vob2xkZXI9XCJwcm9kdWN0IG5hbWVcIiBhdXRvY29tcGxldGU9XCJvZmZcIiB2YWx1ZT1cIiR7Zm9ybURhdGEubmFtZX1cIiByZXF1aXJlZD4gXG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tY29udHJvbCBmb3JtLWVkaXRvclwiPlxuICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvc3RcIiBjbGFzcz1cImxhYmVsLWVkaXRvclwiPtCh0YLQvtC40LzQvtGB0YLRjDwvbGFiZWw+XG4gICAgICAgICAgICAgICAgICA8aW5wdXQgbmFtZT1cImNvc3RcIiBkYXRhLWlkPVwiY29zdFwiIGNsYXNzPVwiaW5wdXQgaW5wdXQtZWRpdG9yXCIgdHlwZT1cIm51bWJlclwiIG1pbj1cIjFcIiBwbGFjZWhvbGRlcj1cInByb2R1Y3QgY29zdFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIHZhbHVlPVwiJHtmb3JtRGF0YS5jb3N0fVwiIHJlcXVpcmVkPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImVkaXRvci1idG5cIj5cbiAgICAgICAgICAgICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiYnRuIGJ0bi1hZGRcIiBkYXRhLXRvZ2dsZT1cImVkaXRvci1hZGRcIiB0aXRsZT1cIlN1Ym1pdCBlZGl0b3IgZm9ybVwiPtCh0L7RhdGA0LDQvdC40YLRjDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLWNsb3NlXCIgZGF0YS10b2dnbGU9XCJlZGl0b3ItY2xvc2VcIiB0aXRsZT1cIkNsb3NlIGVkaXRvciBmb3JtXCI+0JfQsNC60YDRi9GC0Yw8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9mb3JtPlxuICAgICAgICAgIGA7XG4gIH1cbn1cbiIsImltcG9ydCAnLi9wb3BvdmVyLmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcG92ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9jb250YWluZXIgPSBudWxsO1xuICB9XG5cbiAgYmluZFRvRE9NKGNvbnRhaW5lcikge1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmRyYXdVaSgpO1xuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIGRyYXdVaSgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCgpKSByZXR1cm47XG5cbiAgICB0aGlzLl9jb250YWluZXIuaW5uZXJIVE1MID0gUG9wb3Zlci5tYXJrVXA7XG4gIH1cblxuICBpc0JvdW5kKCkge1xuICAgIGlmICh0aGlzLl9jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCgpKSByZXR1cm47XG5cbiAgICBjb25zdCBwb3BvdmVyQnV0dG9uID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5idG4nKTtcbiAgICBwb3BvdmVyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHRoaXMub25DbGljayhlKSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0IG1hcmtVcCgpIHtcbiAgICByZXR1cm4gYFxuICAgICAgPGRpdiBjbGFzcz1cIndyYXBwZXItYnRuXCI+XG4gICAgICAgIDxhIHRhYmluZGV4PVwiMFwiIHJvbGU9XCJidXR0b25cIiBjbGFzcz1cImJ0blwiIGRhdGEtdG9nZ2xlPVwicG9wb3ZlclwiIHRpdGxlPVwiUG9wb3ZlciB0aXRsZVwiIGRhdGEtY29udGVudD1cIkFuZCBoZXJlJ3Mgc29tZSBhbWF6aW5nIGNvbnRlbnQ/XCI+Q2xpY2sgdG8gdG9nZ2xlIHBvcG92ZXI8L2E+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJwb3BvdmVyLW1lc3NhZ2VcIj5cbiAgICAgICAgPGgzIGNsYXNzPVwicG9wb3Zlci10aXRsZVwiPlBvcG92ZXIgdGl0bGU8L2gzPlxuICAgICAgICA8cCBjbGFzcz1cInBvcG92ZXItdGV4dFwiPkFuZCBoZXJlJ3Mgc29tZSBhbWF6aW5nIGNvbnRlbnQuIEl0J3MgdmVyeSBlbmdhZ2luZy4gUmlnaHQ/XCI8L3A+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICB9XG5cbiAgb25DbGljayhlKSB7XG4gICAgdGhpcy5wb3BvdmVyTWVzc2FnZSA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcucG9wb3Zlci1tZXNzYWdlJyk7XG4gICAgdGhpcy5wb3BvdmVyTWVzc2FnZS5jbGFzc0xpc3QudG9nZ2xlKCdwb3BvdmVyLW1lc3NhZ2VfdmlzaWJsZScpO1xuICAgIHRoaXMucG9zaXRpb25Qb3BvdmVyTWVzc2FnZShlKTtcbiAgfVxuXG4gIHBvc2l0aW9uUG9wb3Zlck1lc3NhZ2UoZSkge1xuICAgIGNvbnN0IGNvb3JkcyA9IGUuY3VycmVudFRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBwb3BvdmVyTWVzc2FnZVJlY3QgPSB0aGlzLnBvcG92ZXJNZXNzYWdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgY29uc3QgbGVmdCA9IGNvb3Jkcy5sZWZ0ICsgY29vcmRzLndpZHRoIC8gMiAtIHBvcG92ZXJNZXNzYWdlUmVjdC53aWR0aCAvIDIgKyB3aW5kb3cuc2Nyb2xsWDtcbiAgICBjb25zdCB0b3AgPSBjb29yZHMudG9wIC0gcG9wb3Zlck1lc3NhZ2VSZWN0LmhlaWdodCAtIDIwICsgd2luZG93LnNjcm9sbFk7XG5cbiAgICB0aGlzLnBvcG92ZXJNZXNzYWdlLnN0eWxlLmxlZnQgPSBgJHtsZWZ0fXB4YDtcbiAgICB0aGlzLnBvcG92ZXJNZXNzYWdlLnN0eWxlLnRvcCA9IGAke3RvcH1weGA7XG4gIH1cbn1cbiIsImltcG9ydCBFZGl0b3IgZnJvbSAnLi9FZGl0b3IvRWRpdG9yJztcbmltcG9ydCBQb3BvdmVyIGZyb20gJy4vUG9wb3Zlci9Qb3BvdmVyJztcblxuLyogZXNsaW50LWRpc2FibGUgKi9cbmNvbnNvbGUubG9nKCdpdCB3b3JrcyEnKTtcblxuLy8gdGhlIGZpcnN0IHRhc2sgYWJvdXQgUG9wb3ZlclxuY29uc3QgcG9wb3ZlciA9IG5ldyBQb3BvdmVyKCk7XG5wb3BvdmVyLmJpbmRUb0RPTShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcG9wb3Zlci1jb250YWluZXInKSk7XG5cbi8vIHRoZSBzZWNvbmQgdGFzayBhYm91dCBFZGl0b3JcbmNvbnN0IGVkaXRvciA9IG5ldyBFZGl0b3IoKTtcbmVkaXRvci5iaW5kVG9ET00oZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2VkaXRvci1jb250YWluZXInKSlcblxuIiwiaW1wb3J0IEVkaXRvckZvcm0gZnJvbSAnLi9FZGl0b3JGb3JtL0VkaXRvckZvcm0nO1xuaW1wb3J0IHByb2R1Y3RzQXJyYXkgZnJvbSAnLi9wcm9kdWN0c0FycmF5JztcblxuaW1wb3J0ICcuL2VkaXRvci5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFZGl0b3Ige1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLl9jb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuZWRpdG9yRm9ybSA9IG51bGw7XG4gICAgdGhpcy5kZWxldGVNZXNzYWdlID0gbnVsbDtcbiAgICB0aGlzLnByb2R1Y3RzID0gcHJvZHVjdHNBcnJheTtcbiAgfVxuXG4gIGJpbmRUb0RPTShjb250YWluZXIpIHtcbiAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XG5cbiAgICB0aGlzLmRyYXdVaSgpO1xuICAgIHRoaXMuZXZlbnRzKCk7XG4gIH1cblxuICBkcmF3VWkoKSB7XG4gICAgdGhpcy5jaGVja0JpbmRpbmcoKTtcblxuICAgIHRoaXMuX2NvbnRhaW5lci5pbm5lckhUTUwgPSBgXG4gICAgICA8dGFibGUgY2xhc3M9XCJ0YWJsZVwiPlxuICAgICAgICA8Y2FwdGlvbiBjbGFzcz1cInRpdGxlLXRhYmxlXCI+TXkgZWRpdG9yPC9jYXB0aW9uPlxuICAgICAgICA8dGhlYWQ+XG4gICAgICAgICAgPHRyIGNsYXNzPVwicHJvZHVjdHNcIj5cbiAgICAgICAgICAgIDx0aCAgY29sc3Bhbj1cIjJcIiBzdHlsZT1cInRleHQtYWxpZ246bGVmdFwiPtCi0L7QstCw0YDRizwvdGg+XG4gICAgICAgICAgICA8dGggc3R5bGU9XCJ0ZXh0LWFsaWduOnJpZ2h0XCIgZGF0YS1pZD1cImFkZFwiPjxzcGFuIGNsYXNzPVwiYWRkXCI+4pyZPC9zcGFuPjwvdGg+XG4gICAgICAgICAgPC90cj5cbiAgICAgICAgICA8dHIgY2xhc3M9XCJwcm9kdWN0LXRhYmxlXCI+XG4gICAgICAgICAgICA8dGg+0J3QsNC30LLQsNC90LjQtTwvdGg+XG4gICAgICAgICAgICA8dGg+0KHRgtC+0LjQvNC+0YHRgtGMPC90aD5cbiAgICAgICAgICAgIDx0aD7QlNC10LnRgdGC0LLQuNGPPC90aD5cbiAgICAgICAgICA8L3RyPlxuICAgICAgICA8L3RoZWFkPlxuICAgICAgICA8dGJvZHk+PC90Ym9keT5cbiAgICAgIDwvdGFibGU+XG4gICAgICA8ZGl2IGNsYXNzPVwiZGVsZXRlLW1lc3NhZ2VcIj5cbiAgICAgICAgPGgyPtCS0Ysg0LTQtdC50YHRgtCy0LjRgtC10LvRjNC90L4g0YXQvtGC0LjRgtC1INGD0LTQsNC70LjRgtGMINGC0L7QstCw0YA/PC9oMj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImVkaXRvci1idG5cIj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tYWRkXCIgZGF0YS10b2dnbGU9XCJkZWxldGUtcHJvZHVjdFwiIHRpdGxlPVwiQnV0dG9uIGZvciBkZWxldGUgcHJvZHVjdFwiPtCU0LA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tY2xvc2VcIiBkYXRhLXRvZ2dsZT1cImNsb3NlLW1lc3NhZ2VcIiB0aXRsZT1cIkNsb3NlIGRlbGV0ZSBtZXNzYWdlXCI+0J3QtdGCPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgICBgO1xuXG4gICAgY29uc3QgZWRpdG9yRm9ybSA9IG5ldyBFZGl0b3JGb3JtKHRoaXMuX2NvbnRhaW5lcik7XG4gICAgZWRpdG9yRm9ybS5iaW5kVG9ET00oKTtcblxuICAgIHRoaXMuZWRpdG9yRm9ybSA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuZWRpdG9yLWZvcm0tY29udGFpbmVyJyk7XG4gICAgdGhpcy5kZWxldGVNZXNzYWdlID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5kZWxldGUtbWVzc2FnZScpO1xuICB9XG5cbiAgY2hlY2tCaW5kaW5nKCkge1xuICAgIGlmICh0aGlzLl9jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRm9ybSBub3QgYmluZCB0byBET00nKTtcbiAgICB9XG4gIH1cblxuICBldmVudHMoKSB7XG4gICAgY29uc3QgYWRkRWwgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcignW2RhdGEtaWQ9XCJhZGRcIl0nKTtcbiAgICBjb25zdCBkZWxldGVQcm9kdWN0ID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAnW2RhdGEtdG9nZ2xlPVwiZGVsZXRlLXByb2R1Y3RcIl0nLFxuICAgICk7XG4gICAgY29uc3QgY2xvc2VNZXNzYWdlID0gdGhpcy5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAnW2RhdGEtdG9nZ2xlPVwiY2xvc2UtbWVzc2FnZVwiXScsXG4gICAgKTtcblxuICAgIGFkZEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5zaG93Rm9ybSgpKTtcbiAgICBkZWxldGVQcm9kdWN0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHRoaXMuZGVsZXRlUHJvZHVjdChlKSk7XG4gICAgY2xvc2VNZXNzYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gdGhpcy5jbG9zZU1lc3NhZ2UoKSk7XG4gIH1cblxuICBzaG93Rm9ybSgpIHtcbiAgICB0aGlzLmVkaXRvckZvcm0uY2xhc3NMaXN0LmFkZCgnZWRpdG9yLWZvcm0tY29udGFpbmVyX3Zpc2libGUnKTtcblxuICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCd0Ym9keScpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHRoaXMuZWRpdG9yRm9ybS5zdHlsZS5sZWZ0ID0gYCR7Y29vcmRzLmxlZnQgKyB3aW5kb3cuc2Nyb2xsWCArIGNvb3Jkcy53aWR0aCAvIDIgLSB0aGlzLmVkaXRvckZvcm0ub2Zmc2V0V2lkdGggLyAyfXB4YDtcbiAgICB0aGlzLmVkaXRvckZvcm0uc3R5bGUudG9wID0gYCR7Y29vcmRzLnRvcCArIHdpbmRvdy5zY3JvbGxZfXB4YDtcbiAgfVxuXG4gIGRlbGV0ZVByb2R1Y3QoKSB7XG4gICAgY29uc3QgaW5kZXggPSBwcm9kdWN0c0FycmF5LmZpbmRJbmRleChcbiAgICAgIChlbCkgPT4gZWwuaWQgPT09ICt0aGlzLmRlbGV0ZU1lc3NhZ2UuZGF0YXNldC5pZCxcbiAgICApO1xuICAgIHByb2R1Y3RzQXJyYXkuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgIGNvbnN0IHByb2R1Y3QgPSB0aGlzLl9jb250YWluZXIucXVlcnlTZWxlY3RvcihcbiAgICAgIGBbZGF0YS1yb3c9XCIke3RoaXMuZGVsZXRlTWVzc2FnZS5kYXRhc2V0LmlkfVwiXWAsXG4gICAgKTtcbiAgICBwcm9kdWN0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocHJvZHVjdCk7XG4gICAgdGhpcy5jbG9zZU1lc3NhZ2UoKTtcbiAgfVxuXG4gIGNsb3NlTWVzc2FnZSgpIHtcbiAgICB0aGlzLmRlbGV0ZU1lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZGVsZXRlLW1lc3NhZ2VfdmlzaWJsZScpO1xuICB9XG59XG4iXSwibmFtZXMiOlsicG9wb3ZlciIsInZhbHVlTWlzc2luZyIsImVtYWlsIiwidHlwZU1pc21hdGNoIiwibmFtZSIsImNvc3QiLCJyYW5nZVVuZGVyZmxvdyIsImNyZWF0ZURhdGEiLCJhcnJheSIsIm8iLCJmb3JFYWNoIiwiZWwiLCJrZXkiLCJkYXRhc2V0IiwiaWQiLCJ2YWx1ZSIsIlByb2R1Y3QiLCJjb25zdHJ1Y3RvciIsImRhdGEiLCJjb250YWluZXIiLCJ0aGlzIiwicm93IiwiZGF0YVByb2R1Y3QiLCJiaW5kVG9ET00iLCJpbm5lckhUTUwiLCJldmVudHMiLCJ1cGRhdGVCdG4iLCJxdWVyeVNlbGVjdG9yIiwiZGVsZXRlQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVwZGF0ZSIsImRlbGV0ZSIsImZvcm0iLCJkb2N1bWVudCIsInNldEF0dHJpYnV0ZSIsImNsb3Nlc3QiLCJjbGFzc0xpc3QiLCJhZGQiLCJuYW1lSW5wdXQiLCJjb3N0SW5wdXQiLCJfZGVsZXRlTWVzc2FnZSIsInRib2R5UmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInN0eWxlIiwibGVmdCIsIndpbmRvdyIsInNjcm9sbFgiLCJ3aWR0aCIsIm9mZnNldFdpZHRoIiwidG9wIiwic2Nyb2xsWSIsIm1hcmtVcCIsIlRvb2x0aXAiLCJfdG9vbHRpcHMiLCJzaG93VG9vbHRpcCIsIm1lc3NhZ2UiLCJlbGVtZW50IiwidG9vbHRpcEVsZW1lbnQiLCJjcmVhdGVFbGVtZW50IiwidGV4dENvbnRlbnQiLCJwZXJmb3JtYW5jZSIsIm5vdyIsInB1c2giLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJib3R0b20iLCJyZW1vdmVUb29sdGlwIiwiZmluZCIsInQiLCJyZW1vdmUiLCJmaWx0ZXIiLCJnZXRFcnJvciIsImVycm9ycyIsImVycm9yS2V5IiwiT2JqZWN0Iiwia2V5cyIsIlZhbGlkaXR5U3RhdGUiLCJwcm90b3R5cGUiLCJ2YWxpZGl0eSIsIkVkaXRvckZvcm0iLCJfY29udGFpbmVyIiwiX2Zvcm1Db250YWluZXIiLCJfZXJyb3JFbGVtZW50IiwiX2Zvcm0iLCJfdG9vbHRpcEZhY3RvcnkiLCJwcm9kdWN0c0FycmF5IiwiYWN0dWFsTWVzc2FnZXMiLCJjcmVhdGVGb3JtQ29udGFpbmVyIiwic2V0RXZlbnRzIiwic2V0Rm9ybURhdGEiLCJmb3JtTWFya3VwIiwiZm9ybURhdGEiLCJhcHBlbmQiLCJjbG9zZUZvcm0iLCJlIiwib25TdWJtaXQiLCJlbGVtZW50T25CbHVyIiwidGFyZ2V0IiwiZXJyb3IiLCJtZXNzYWdlcyIsIm1lc3NhZ2VJbmRleCIsImZpbmRJbmRleCIsIml0ZW0iLCJzcGxpY2UiLCJyZW1vdmVBdHRyaWJ1dGUiLCJyZXNldCIsInByZXZlbnREZWZhdWx0IiwiaGFuZGxlVmFsaWRhdGlvbiIsImZvcm1FbGVtZW50cyIsImVsZW1lbnRzIiwiY2hlY2tWYWxpZGl0eSIsInByb2Nlc3NGb3JtRGF0YSIsInNob3dFcnJvcnMiLCJlbGVtIiwidXBkYXRlUHJvZHVjdCIsImNyZWF0ZVByb2R1Y3QiLCJpbmRleCIsInByb2R1Y3REYXRhIiwicHJvZHVjdCIsImlubmVyVGV4dCIsIkRhdGUiLCJ0YWJsZUJvZHkiLCJ0YWJsZVJvdyIsInN0YXRpYyIsIlBvcG92ZXIiLCJkcmF3VWkiLCJzZXRFdmVudExpc3RlbmVycyIsImlzQm91bmQiLCJvbkNsaWNrIiwicG9wb3Zlck1lc3NhZ2UiLCJ0b2dnbGUiLCJwb3NpdGlvblBvcG92ZXJNZXNzYWdlIiwiY29vcmRzIiwiY3VycmVudFRhcmdldCIsInBvcG92ZXJNZXNzYWdlUmVjdCIsImhlaWdodCIsImNvbnNvbGUiLCJsb2ciLCJlZGl0b3JGb3JtIiwiZGVsZXRlTWVzc2FnZSIsInByb2R1Y3RzIiwiY2hlY2tCaW5kaW5nIiwiRXJyb3IiLCJhZGRFbCIsImRlbGV0ZVByb2R1Y3QiLCJjbG9zZU1lc3NhZ2UiLCJzaG93Rm9ybSIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCJdLCJzb3VyY2VSb290IjoiIn0=